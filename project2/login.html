<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h2>로그인</h2>
    <div>
      <!-- <input type="hidden" name="action" value="regist" /> -->
      <label>아이디 : </label>
      <input type="text" placeholder="아이디를 입력하세요" id="userId" /><br />
      <label>비밀번호 : </label>
      <input
        type="password"
        placeholder="비밀번호를 입력하세요"
        id="password"
      /><br />

      <button id="idBtn">로그인</button>
    </div>
    <script>
      const loginBtn = document.querySelector("#idBtn");
      const userId = document.querySelector("#userId");
      const password = document.querySelector("#password");
      let xhr;
      function requestMsg() {
        xhr = new XMLHttpRequest();
        xhr.onreadystatechange = callbackFunc;
        xhr.open("GET", "./user.json");
        xhr.send(null);
      }
      function callbackFunc() {
        if (xhr.readyState == 4) {
          if (xhr.status == 200) {
            //JSON 파일을 읽어왔다. (얘는 어짜피 문자열)
            let userList = JSON.parse(xhr.response);
            console.log(userList);
            let verified = false;
            for (let i = 0; i < userList.length; i++) {
              console.log(userList[i]);
              if (
                userList[i].userId === userId.value &&
                userList[i].userPw === password.value
              ) {
                verified = true;
                let { userPw, ...rest } = userList[i];

                localStorage.setItem("user", JSON.stringify(rest));
                location.href = "./main.html";
              }
            }
            if (!verified) {
              alert("회원정보가 없거나 비밀번호가 다릅니다.");
              userId.value = "";
              password.value = "";
            }
          }
        }
      }

      loginBtn.addEventListener("click", () => {
        requestMsg();
      });
    </script>
  </body>
</html>
